@using Microsoft.AspNetCore.Authorization
@using VOC.Authorization
@inject IAuthorizationService AuthorizationService
@model GmesDataViewModel
@{
    ViewData["Title"] = "UploadList";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section Scripts
{
    <script src="~/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/app/controllers/ppm/ppmMns.js"></script>
    <script>
        var controller = new ppmController();
        controller.initialize();

        $(document).ready(function () {
            $('#vocGmesByYearDataTable').DataTable({
                "order": [4, 'asc']
            });
            $('#vocGmesPPMDataTable').DataTable({
                "order": [7, 'asc']
            });
            $('input[type=search]').addClass('floating').removeClass('form-control-sm').css('width', 200).attr('placeholder', 'Type to search.');
            $('select[name="vocGmesByYearDataTable_length"]').removeClass('form-control-sm');
            $('select[name="vocGmesPPMDataTable_length"]').removeClass('form-control-sm');
        });

        onSuccess = function () {

        }

        $('#txtYear').datetimepicker({
            format: 'YYYY',//'DD/MM/YYYY',
            icons: {
                up: "fa fa-angle-up",
                down: "fa fa-angle-down",
                next: 'fa fa-angle-right',
                previous: 'fa fa-angle-left'
            }
        });

        $('#txtYear_gmes').datetimepicker({
            format: 'YYYY-MM',//'DD/MM/YYYY',
            icons: {
                up: "fa fa-angle-up",
                down: "fa fa-angle-down",
                next: 'fa fa-angle-right',
                previous: 'fa fa-angle-left'
            }
        });

        $('#txtYearMonth').datetimepicker({
            format: 'YYYY-MM',//'DD/MM/YYYY',
            icons: {
                up: "fa fa-angle-up",
                down: "fa fa-angle-down",
                next: 'fa fa-angle-right',
                previous: 'fa fa-angle-left'
            }
        });

    </script>
}

@section Styles{
    <style>
        div.table-responsive > div.dataTables_wrapper > div.row {
            margin: 5px;
        }

        #btnPmmByYear, #btnGmes {
            background-color: dodgerblue;
            color: white;
        }
    </style>
}

@{
    var pCreate = await AuthorizationService.AuthorizeAsync(User, "uK1", Operations.Create);
    var pDelete = await AuthorizationService.AuthorizeAsync(User, "uK1", Operations.Delete);
    var pUpdate = await AuthorizationService.AuthorizeAsync(User, "uK1", Operations.Update);
    var pImport = await AuthorizationService.AuthorizeAsync(User, "uK1", Operations.Import);
}

<div class="content container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <div class="row">
            <div class="col-sm-12">
                <h3 class="page-title">Customer GMES Data</h3>
            </div>
        </div>
    </div>

    @if (pImport.Succeeded)
    {
        <div class="page-header">
            <div class="row align-items-center">
                <div class="col">
                </div>
                <div class="col-auto float-right ml-auto">
                    <div class="btn-group">
                        <button type="button" class="btn btn-info dropdown-toggle" id="btnManagement" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Upload Data</button>
                        <div class="dropdown-menu" style="">
                            <a class="dropdown-item" href="~/templates/Customer_GMES_Data.xlsx">Get K1 Template By Month</a>
                            <a class="dropdown-item" href="#" id="btn-importK1Month">Import K1 By Month</a>
                            <a class="dropdown-item" href="~/templates/Customer_GMES_DataByYear.xlsx">Get K1 Template By Year</a>
                            <a class="dropdown-item" href="#" id="btn-importK1Year">Import K1 By Year</a>
                            <a class="dropdown-item" href="#" id="btn-UpdateLastDay">Last Day Update</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="row">
        <div class="col-md-5">
            <div class="card card-table">
                <div class="card-header">
                    <h3 class="card-title mb-0" style="display:inline">
                        Data PPM By Year
                    </h3>

                    @if (pCreate.Succeeded)
                    {
                        <a href="#" id="btnPmmByYear" class="btn" style="float:right" data-toggle="modal" data-target="#addEdiPPMByYear"><i class="fa fa-plus"></i> Add</a>
                    }
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover mb-0 table-striped custom-table datatable" id="vocGmesByYearDataTable" style="width:100%">
                            <thead>
                                <tr>
                                    <th>CSP/LFEM</th>
                                    <th>Actual PPM</th>
                                    <th>Target PPM</th>
                                    <th>Year</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="tbl-content-vocGmesByYearDataTable">
                                @foreach (var item in Model.vocPPMYearViewModels)
                                {
                                    <tr>
                                        <td>@item.Module</td>
                                        <td>@item.ValuePPM</td>
                                        <td>@item.TargetPPM</td>
                                        <td>@item.Year</td>
                                        <td class="text-right">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="material-icons">more_vert</i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    @if (pUpdate.Succeeded)
                                                    {
                                                        <a class="dropdown-item edit-ppmYear" href="#" data-toggle="modal" data-target="#addEdi_ppmYear" data-id="@item.Id"><i class="fa fa-edit m-r-5"></i> Edit</a>
                                                    }

                                                    @if (pDelete.Succeeded)
                                                    {
                                                        <a class="dropdown-item delete-ppmYear" href="#" data-toggle="modal" data-target="#delete_ppmYearModel" data-id="@item.Id"><i class="fa fa-trash-o m-r-5"></i> Delete</a>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card card-table">
                <div class="card-header">
                    <h3 class="card-title mb-0" style="display:inline">
                        Data Actual By Month/Year
                    </h3>
                    <div style="display: inline-flex; float: right;">
                        <form action="/admin/k1/searchUpload" method="post">
                            <div class="form-group form-focus select-focus">
                                <div class="cal-icon"><input id="txtYearMonth" style="margin-top:5px" value="@Model.Year" name="yearMonth" class="form-control datetimepicker" type="text"></div>
                                <label class="focus-label">Year-Month</label>
                            </div>
                            @if (pCreate.Succeeded)
                            {
                                <a href="#" id="btnGmes" class="btn" data-toggle="modal" data-target="#addEdiGmesDataByMonth"><i class="fa fa-plus"></i> Add</a>
                            }
                            <button id="btnSearch" type="submit" class="btn btn-success"> Search </button>
                        </form>

                       
                    </div>

                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover mb-0 table-striped custom-table datatable" id="vocGmesPPMDataTable" style="width:100%">
                            <thead>
                                <tr>
                                    <th>CSP/LFEM</th>
                                    <th>Customer</th>
                                    <th>Type</th>
                                    <th>Actual PPM</th>
                                    <th>Target PPM</th>
                                    <th>Year</th>
                                    <th>Month</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="tbl-content-vocGmesPPMDataTable">
                                @foreach (var item in Model.vocPPMViewModels)
                                {
                                    <tr>
                                        <td>@item.Module</td>
                                        <td>@item.Customer</td>
                                        <td>@item.Type</td>
                                        <td>@item.Value</td>
                                        <td>@item.TargetValue</td>
                                        <td>@item.Year</td>
                                        <td>@item.Month</td>
                                        <td class="text-right">
                                            <div class="dropdown dropdown-action">
                                                <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="material-icons">more_vert</i></a>
                                                <div class="dropdown-menu dropdown-menu-right">
                                                    @if (pUpdate.Succeeded)
                                                    {
                                                        <a class="dropdown-item edit-ppmYearMonth" href="#" data-toggle="modal" data-target="#addEdi_ppm" data-id="@item.Id"><i class="fa fa-edit m-r-5"></i> Edit</a>
                                                    }

                                                    @if (pDelete.Succeeded)
                                                    {
                                                        <a class="dropdown-item delete-ppmYearMonth" href="#" data-toggle="modal" data-target="#delete_ppmModel" data-id="@item.Id"><i class="fa fa-trash-o m-r-5"></i> Delete</a>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<partial name="_addEditPPM_ByYearView" />
<partial name="_addEditGmesDataByMonthView" />
<partial name="_importExcelModelView" />

<div class="modal custom-modal fade" id="delete_ppm" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <h3>Delete</h3>
                    <p>Are you sure want to delete?</p>
                    <input type="hidden" id="txtIdDelete" />
                    <input type="hidden" id="txtTypeDelete" />
                </div>
                <div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
                            <a href="javascript:void(0);" class="btn btn-primary continue-btn" id="btnDelete">Delete</a>
                        </div>
                        <div class="col-6">
                            <a href="javascript:void(0);" data-dismiss="modal" class="btn btn-primary cancel-btn">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal custom-modal fade" id="update-LastDay-Model" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <h3>Update day</h3>
                    <div class="cal-icon">
                        <input id="txtUpdateDate" class="form-control datetimepicker" type="text">
                    </div>
                </div>
                <div class="modal-btn delete-action">
                    <div class="row">
                        <div class="col-6">
                            <a href="javascript:void(0);" class="btn btn-primary continue-btn" id="btnUpdateDay">Update</a>
                        </div>
                        <div class="col-6">
                            <a href="javascript:void(0);" data-dismiss="modal" class="btn btn-primary cancel-btn">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


