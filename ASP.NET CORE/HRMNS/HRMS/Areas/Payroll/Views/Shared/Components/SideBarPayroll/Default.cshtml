@using Microsoft.AspNetCore.Authorization
@using HRMS.Authorization

@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@inject IAuthorizationService AuthorizationService
@model List<FunctionViewModel>
<div class="sidebar" id="sidebar">
    <div class="sidebar-inner slimscroll">
        <div id="sidebar-menu" class="sidebar-menu">
            <ul>
                <li class="menu-title">
                    <span>Main</span>
                </li>
                @*<li class="submenu">*@
                <li>
                    <a href="/Payroll/Home/Index" target="_self" onclick="linkClick(this)"><i class="la la-dashboard"></i> <span> @localizer["Home"]</span></a>
                </li>

                @foreach (var item in Model.Where(x => string.IsNullOrEmpty(x.ParentId)))
                {
                    <li class="menu-title">
                        <span>@item.Name</span>
                    </li>

                    @if (Model.Any(x => x.ParentId == item.Id))
                    {
                        @foreach (var subItem in Model.Where(x => x.ParentId == item.Id))
                        {
                            @if (Model.Any(x => x.ParentId == subItem.Id))
                            {
                                <li class="submenu">
                                    <a href="#"><i class="@subItem.IconCss"></i> <span>@(localizer[subItem.Id])</span> <span class="menu-arrow"></span></a>
                                    <ul style="display: none;">
                                        @foreach (var childItem in Model.Where(x => x.ParentId == subItem.Id))
                                        {
                                            <li><a href="@childItem.URL" id="@childItem.Id" data-id="@childItem.Id" onclick="linkClick(this)">@(localizer[childItem.Id])</a></li>
                                        }
                                    </ul>
                                </li>
                            }
                            else
                            {
                                <li id="@subItem.Id">
                                    <a href="@subItem.URL" onclick="linkClick2('@subItem.Id')"><i class="@subItem.IconCss"></i> <span>@(localizer[subItem.Id])</span></a>
                                </li>
                            }
                        }
                    }
                }

            </ul>
        </div>
    </div>
</div>
<script>
    function linkClick(item) {
        sessionStorage.setItem('activeLink', item.id);
    }
    function linkClick2(id) {
        sessionStorage.setItem('activeLink', id);
    }
    (function () {
        let id = sessionStorage.getItem("activeLink");
        let element = document.getElementById(id);
        if (element) {
            element.classList.remove("active");
            element.classList.add("active");
        }
    })();
</script>